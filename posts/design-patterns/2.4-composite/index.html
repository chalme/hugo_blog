<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>2.4 Composite | Chalme</title><meta name=keywords content="Design Patterns"><meta name=description content="Composite(组合模式)定义 将对象以树形结构组织起来,以达成“部分－整体” 的层次结构，使得客户端对单个对象和组合对象的使用具有一致性.
Composite比较容易理解，想到Composite就应该想到树形结构图。组合体内这些对象都有共同接口,当组合体一个对象的方法被调用执行时，Composite将遍历(Iterator)整个树形结构,寻找同样包含这个方法的对象并实现调用执行。可以用牵一动百来形容。
所以Composite模式使用到Iterator模式，和Chain of Responsibility模式类似。
本质 定义 interface 或 abstract class
核心 在class(继承或实现) 中使用了 arraylist . 可以在其中添加 其他 对象（继承同一class）
Composite好处 使客户端调用简单，客户端可以一致的使用组合结构或其中单个对象，用户就不必关系自己处理的是单个对象还是整个组合结构，这就简化了客户端代码。 更容易在组合体内加入对象部件. 客户端不必因为加入了新的对象部件而更改代码。 如何使用Composite 首先定义一个接口或抽象类，这是设计模式通用方式了，其他设计模式对接口内部定义限制不多，Composite却有个规定，那就是要在接口内部定义一个用于访问和管理Composite组合体的对象们（或称部件Component）.
下面的代码是以抽象类定义，一般尽量用接口interface,
public abstract class Equipment { private String name; //实价 public abstract double netPrice(); //折扣价格 public abstract double discountPrice(); //增加部件方法　public boolean add(Equipment equipment) { return false; } //删除部件方法 public boolean remove(Equipment equipment) { return false; } //注意这里，这里就提供一种用于访问组合体类的部件方法。 public Iterator iter() { return null; } public Equipment(final String name) { this."><meta name=author content="Me"><link rel=canonical href=http://blog.chalme.top/posts/design-patterns/2.4-composite/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.bccfefac377bc340f06c260aed1bddf49a4354816d7c570d6aac75a997986c95.css integrity="sha256-vM/vrDd7w0DwbCYK7Rvd9JpDVIFtfFcNaqx1qZeYbJU=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=http://blog.chalme.top/favicon_io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=http://blog.chalme.top/favicon_io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=http://blog.chalme.top/favicon_io/favicon-32x32.png><link rel=apple-touch-icon href=http://blog.chalme.top/favicon_io/apple-touch-icon.png><link rel=mask-icon href=http://blog.chalme.top/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="2.4 Composite"><meta property="og:description" content="Composite(组合模式)定义 将对象以树形结构组织起来,以达成“部分－整体” 的层次结构，使得客户端对单个对象和组合对象的使用具有一致性.
Composite比较容易理解，想到Composite就应该想到树形结构图。组合体内这些对象都有共同接口,当组合体一个对象的方法被调用执行时，Composite将遍历(Iterator)整个树形结构,寻找同样包含这个方法的对象并实现调用执行。可以用牵一动百来形容。
所以Composite模式使用到Iterator模式，和Chain of Responsibility模式类似。
本质 定义 interface 或 abstract class
核心 在class(继承或实现) 中使用了 arraylist . 可以在其中添加 其他 对象（继承同一class）
Composite好处 使客户端调用简单，客户端可以一致的使用组合结构或其中单个对象，用户就不必关系自己处理的是单个对象还是整个组合结构，这就简化了客户端代码。 更容易在组合体内加入对象部件. 客户端不必因为加入了新的对象部件而更改代码。 如何使用Composite 首先定义一个接口或抽象类，这是设计模式通用方式了，其他设计模式对接口内部定义限制不多，Composite却有个规定，那就是要在接口内部定义一个用于访问和管理Composite组合体的对象们（或称部件Component）.
下面的代码是以抽象类定义，一般尽量用接口interface,
public abstract class Equipment { private String name; //实价 public abstract double netPrice(); //折扣价格 public abstract double discountPrice(); //增加部件方法　public boolean add(Equipment equipment) { return false; } //删除部件方法 public boolean remove(Equipment equipment) { return false; } //注意这里，这里就提供一种用于访问组合体类的部件方法。 public Iterator iter() { return null; } public Equipment(final String name) { this."><meta property="og:type" content="article"><meta property="og:url" content="http://blog.chalme.top/posts/design-patterns/2.4-composite/"><meta property="og:image" content="http://blog.chalme.top/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2017-01-24T18:00:39+08:00"><meta property="article:modified_time" content="2017-01-24T18:00:39+08:00"><meta property="og:site_name" content="Chalme"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://blog.chalme.top/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="2.4 Composite"><meta name=twitter:description content="Composite(组合模式)定义 将对象以树形结构组织起来,以达成“部分－整体” 的层次结构，使得客户端对单个对象和组合对象的使用具有一致性.
Composite比较容易理解，想到Composite就应该想到树形结构图。组合体内这些对象都有共同接口,当组合体一个对象的方法被调用执行时，Composite将遍历(Iterator)整个树形结构,寻找同样包含这个方法的对象并实现调用执行。可以用牵一动百来形容。
所以Composite模式使用到Iterator模式，和Chain of Responsibility模式类似。
本质 定义 interface 或 abstract class
核心 在class(继承或实现) 中使用了 arraylist . 可以在其中添加 其他 对象（继承同一class）
Composite好处 使客户端调用简单，客户端可以一致的使用组合结构或其中单个对象，用户就不必关系自己处理的是单个对象还是整个组合结构，这就简化了客户端代码。 更容易在组合体内加入对象部件. 客户端不必因为加入了新的对象部件而更改代码。 如何使用Composite 首先定义一个接口或抽象类，这是设计模式通用方式了，其他设计模式对接口内部定义限制不多，Composite却有个规定，那就是要在接口内部定义一个用于访问和管理Composite组合体的对象们（或称部件Component）.
下面的代码是以抽象类定义，一般尽量用接口interface,
public abstract class Equipment { private String name; //实价 public abstract double netPrice(); //折扣价格 public abstract double discountPrice(); //增加部件方法　public boolean add(Equipment equipment) { return false; } //删除部件方法 public boolean remove(Equipment equipment) { return false; } //注意这里，这里就提供一种用于访问组合体类的部件方法。 public Iterator iter() { return null; } public Equipment(final String name) { this."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"http://blog.chalme.top/posts/"},{"@type":"ListItem","position":2,"name":"2.4 Composite","item":"http://blog.chalme.top/posts/design-patterns/2.4-composite/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"2.4 Composite","name":"2.4 Composite","description":"Composite(组合模式)定义 将对象以树形结构组织起来,以达成“部分－整体” 的层次结构，使得客户端对单个对象和组合对象的使用具有一致性.\nComposite比较容易理解，想到Composite就应该想到树形结构图。组合体内这些对象都有共同接口,当组合体一个对象的方法被调用执行时，Composite将遍历(Iterator)整个树形结构,寻找同样包含这个方法的对象并实现调用执行。可以用牵一动百来形容。\n所以Composite模式使用到Iterator模式，和Chain of Responsibility模式类似。\n本质 定义 interface 或 abstract class\n核心 在class(继承或实现) 中使用了 arraylist . 可以在其中添加 其他 对象（继承同一class）\nComposite好处 使客户端调用简单，客户端可以一致的使用组合结构或其中单个对象，用户就不必关系自己处理的是单个对象还是整个组合结构，这就简化了客户端代码。 更容易在组合体内加入对象部件. 客户端不必因为加入了新的对象部件而更改代码。 如何使用Composite 首先定义一个接口或抽象类，这是设计模式通用方式了，其他设计模式对接口内部定义限制不多，Composite却有个规定，那就是要在接口内部定义一个用于访问和管理Composite组合体的对象们（或称部件Component）.\n下面的代码是以抽象类定义，一般尽量用接口interface,\npublic abstract class Equipment { private String name; //实价 public abstract double netPrice(); //折扣价格 public abstract double discountPrice(); //增加部件方法　public boolean add(Equipment equipment) { return false; } //删除部件方法 public boolean remove(Equipment equipment) { return false; } //注意这里，这里就提供一种用于访问组合体类的部件方法。 public Iterator iter() { return null; } public Equipment(final String name) { this.","keywords":["Design Patterns"],"articleBody":"Composite(组合模式)定义 将对象以树形结构组织起来,以达成“部分－整体” 的层次结构，使得客户端对单个对象和组合对象的使用具有一致性.\nComposite比较容易理解，想到Composite就应该想到树形结构图。组合体内这些对象都有共同接口,当组合体一个对象的方法被调用执行时，Composite将遍历(Iterator)整个树形结构,寻找同样包含这个方法的对象并实现调用执行。可以用牵一动百来形容。\n所以Composite模式使用到Iterator模式，和Chain of Responsibility模式类似。\n本质 定义 interface 或 abstract class\n核心 在class(继承或实现) 中使用了 arraylist . 可以在其中添加 其他 对象（继承同一class）\nComposite好处 使客户端调用简单，客户端可以一致的使用组合结构或其中单个对象，用户就不必关系自己处理的是单个对象还是整个组合结构，这就简化了客户端代码。 更容易在组合体内加入对象部件. 客户端不必因为加入了新的对象部件而更改代码。 如何使用Composite 首先定义一个接口或抽象类，这是设计模式通用方式了，其他设计模式对接口内部定义限制不多，Composite却有个规定，那就是要在接口内部定义一个用于访问和管理Composite组合体的对象们（或称部件Component）.\n下面的代码是以抽象类定义，一般尽量用接口interface,\npublic abstract class Equipment { private String name; //实价 public abstract double netPrice(); //折扣价格 public abstract double discountPrice(); //增加部件方法　public boolean add(Equipment equipment) { return false; } //删除部件方法 public boolean remove(Equipment equipment) { return false; } //注意这里，这里就提供一种用于访问组合体类的部件方法。 public Iterator iter() { return null; } public Equipment(final String name) { this.name=name; } } 抽象类Equipment就是Component定义，代表着组合体类的对象们,Equipment中定义几个共同的方法。\npublic class Disk extends Equipment { public Disk(String name) { super(name); } //定义Disk实价为1 public double netPrice() { return 1.; } //定义了disk折扣价格是0.5 对折。 public double discountPrice() { return .5; } } Disk是组合体内的一个对象，或称一个部件，这个部件是个单独元素( Primitive)。 还有一种可能是，一个部件也是一个组合体，就是说这个部件下面还有’儿子’，这是树形结构中通常的情况，应该比较容易理解。现在我们先要定义这个组合体：\nabstract class CompositeEquipment extends Equipment { private int i=0; //定义一个Vector 用来存放'儿子' private Lsit equipment=new ArrayList(); public CompositeEquipment(String name) { super(name); } public boolean add(Equipment equipment) { this.equipment.add(equipment); return true; } public double netPrice() { double netPrice=0.; Iterator iter=equipment.iterator(); for(iter.hasNext()) netPrice+=((Equipment)iter.next()).netPrice(); return netPrice; } public double discountPrice() { double discountPrice=0.; Iterator iter=equipment.iterator(); for(iter.hasNext()) discountPrice+=((Equipment)iter.next()).discountPrice(); return discountPrice; } //注意这里，这里就提供用于访问自己组合体内的部件方法。 //上面dIsk 之所以没有，是因为Disk是个单独(Primitive)的元素. public Iterator iter() { return equipment.iterator() ; { //重载Iterator方法 public boolean hasNext() { return i\u003cequipment.size(); } //重载Iterator方法 public Object next() { if(hasNext()) return equipment.elementAt(i++); else throw new NoSuchElementException(); } } 上面CompositeEquipment继承了Equipment,同时为自己里面的对象们提供了外部访问的方法,重载了Iterator,Iterator是Java的Collection的一个接口，是Iterator模式的实现.\n我们再看看CompositeEquipment的两个具体类:盘盒Chassis和箱子Cabinet，箱子里面可以放很多东西，如底板，电源盒，硬盘盒等；盘盒里面可以放一些小设备，如硬盘 软驱等。无疑这两个都是属于组合体性质的。\npublic class Chassis extends CompositeEquipment { public Chassis(String name) { super(name); } public double netPrice() { return 1.+super.netPrice(); } public double discountPrice() { return .5+super.discountPrice(); } } public class Cabinet extends CompositeEquipment { public Cabinet(String name) { super(name); } public double netPrice() { return 1.+super.netPrice(); } public double discountPrice() { return .5+super.discountPrice(); } } 至此我们完成了整个Composite模式的架构。\n我们可以看看客户端调用Composote代码:\nCabinet cabinet=new Cabinet(\"Tower\"); Chassis chassis=new Chassis(\"PC Chassis\"); //将PC Chassis装到Tower中 (将盘盒装到箱子里) cabinet.add(chassis); //将一个10GB的硬盘装到 PC Chassis (将硬盘装到盘盒里) chassis.add(new Disk(\"10 GB\")); //调用 netPrice()方法; System.out.println(\"netPrice=\"+cabinet.netPrice()); System.out.println(\"discountPrice=\"+cabinet.discountPrice()); 上面调用的方法netPrice()或discountPrice()，实际上Composite使用Iterator遍历了整个树形结构,寻找同样包含这个方法的对象并实现调用执行.\nComposite是个很巧妙体现智慧的模式，在实际应用中，如果碰到树形结构，我们就可以尝试是否可以使用这个模式。\n","wordCount":"286","inLanguage":"en","datePublished":"2017-01-24T18:00:39+08:00","dateModified":"2017-01-24T18:00:39+08:00","author":{"@type":"Person","name":"Me"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://blog.chalme.top/posts/design-patterns/2.4-composite/"},"publisher":{"@type":"Organization","name":"Chalme","logo":{"@type":"ImageObject","url":"http://blog.chalme.top/favicon_io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=http://blog.chalme.top/ accesskey=h title="Chalme (Alt + H)"><img src=http://blog.chalme.top/favicon_io/apple-touch-icon.png alt aria-label=logo height=35>Chalme</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=http://blog.chalme.top/archives title=Archive><span>Archive</span></a></li><li><a href=http://blog.chalme.top/search title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=http://blog.chalme.top/tags title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=http://blog.chalme.top/>Home</a>&nbsp;»&nbsp;<a href=http://blog.chalme.top/posts/>Posts</a></div><h1 class=post-title>2.4 Composite</h1><div class=post-meta><span title='2017-01-24 18:00:39 +0800 +0800'>January 24, 2017</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;286 words&nbsp;·&nbsp;Me&nbsp;|&nbsp;<a href=https://github.com/chalme/hugo_blog/blob/main/content/posts/design-patterns/2.4%20Composite.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#composite组合模式定义>Composite(组合模式)定义</a></li><li><a href=#本质>本质</a></li><li><a href=#composite好处>Composite好处</a></li><li><a href=#如何使用composite>如何使用Composite</a></li></ul></nav></div></details></div><div class=post-content><h2 id=composite组合模式定义>Composite(组合模式)定义<a hidden class=anchor aria-hidden=true href=#composite组合模式定义>#</a></h2><blockquote><p>将对象以树形结构组织起来,以达成“部分－整体” 的层次结构，使得客户端对单个对象和组合对象的使用具有一致性.</p></blockquote><p>Composite比较容易理解，想到Composite就应该想到树形结构图。组合体内这些对象都有共同接口,当组合体一个对象的方法被调用执行时，Composite将遍历(Iterator)整个树形结构,寻找同样包含这个方法的对象并实现调用执行。可以用牵一动百来形容。</p><p>所以Composite模式使用到Iterator模式，和Chain of Responsibility模式类似。</p><h2 id=本质>本质<a hidden class=anchor aria-hidden=true href=#本质>#</a></h2><ol><li><p>定义 interface 或 abstract class</p></li><li><p><code>核心</code> 在class(继承或实现) 中使用了 arraylist . 可以在其中添加 其他 对象（继承同一class）</p></li></ol><h2 id=composite好处>Composite好处<a hidden class=anchor aria-hidden=true href=#composite好处>#</a></h2><ol><li>使客户端调用简单，客户端可以一致的使用组合结构或其中单个对象，用户就不必关系自己处理的是单个对象还是整个组合结构，这就简化了客户端代码。</li><li>更容易在组合体内加入对象部件. 客户端不必因为加入了新的对象部件而更改代码。</li></ol><h2 id=如何使用composite>如何使用Composite<a hidden class=anchor aria-hidden=true href=#如何使用composite>#</a></h2><p>首先定义一个接口或抽象类，这是设计模式通用方式了，其他设计模式对接口内部定义限制不多，Composite却有个规定，那就是要在接口内部定义一个用于访问和管理Composite组合体的对象们（或称部件Component）.</p><p>下面的代码是以抽象类定义，一般尽量用接口interface,</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>abstract</span> <span class=kd>class</span> <span class=nc>Equipment</span>
</span></span><span class=line><span class=cl><span class=o>{</span>
</span></span><span class=line><span class=cl><span class=err>　　</span><span class=kd>private</span> <span class=n>String</span> <span class=n>name</span><span class=o>;</span> 
</span></span><span class=line><span class=cl><span class=err>　　</span><span class=c1>//实价
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=err>　　</span><span class=kd>public</span> <span class=kd>abstract</span> <span class=kt>double</span> <span class=nf>netPrice</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=err>　　</span><span class=c1>//折扣价格
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=err>　　</span><span class=kd>public</span> <span class=kd>abstract</span> <span class=kt>double</span> <span class=nf>discountPrice</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=err>　　</span><span class=c1>//增加部件方法　　
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=err>　　</span><span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>add</span><span class=o>(</span><span class=n>Equipment</span> <span class=n>equipment</span><span class=o>)</span> <span class=o>{</span> <span class=k>return</span> <span class=kc>false</span><span class=o>;</span> <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=err>　　</span><span class=c1>//删除部件方法
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=err>　　</span><span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>remove</span><span class=o>(</span><span class=n>Equipment</span> <span class=n>equipment</span><span class=o>)</span> <span class=o>{</span> <span class=k>return</span> <span class=kc>false</span><span class=o>;</span> <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=err>　　</span><span class=c1>//注意这里，这里就提供一种用于访问组合体类的部件方法。
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=err>　　</span><span class=kd>public</span> <span class=n>Iterator</span> <span class=nf>iter</span><span class=o>()</span> <span class=o>{</span> <span class=k>return</span> <span class=kc>null</span><span class=o>;</span> <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=err>　　</span>
</span></span><span class=line><span class=cl><span class=err>　　</span><span class=kd>public</span> <span class=nf>Equipment</span><span class=o>(</span><span class=kd>final</span> <span class=n>String</span> <span class=n>name</span><span class=o>)</span> <span class=o>{</span> <span class=k>this</span><span class=o>.</span><span class=na>name</span><span class=o>=</span><span class=n>name</span><span class=o>;</span> <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>  
</span></span></code></pre></div><p>抽象类Equipment就是Component定义，代表着组合体类的对象们,Equipment中定义几个共同的方法。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Disk</span> <span class=kd>extends</span> <span class=n>Equipment</span>
</span></span><span class=line><span class=cl><span class=o>{</span>
</span></span><span class=line><span class=cl><span class=err>　　</span><span class=kd>public</span> <span class=nf>Disk</span><span class=o>(</span><span class=n>String</span> <span class=n>name</span><span class=o>)</span> <span class=o>{</span> <span class=kd>super</span><span class=o>(</span><span class=n>name</span><span class=o>);</span> <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=err>　　</span><span class=c1>//定义Disk实价为1
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=err>　　</span><span class=kd>public</span> <span class=kt>double</span> <span class=nf>netPrice</span><span class=o>()</span> <span class=o>{</span> <span class=k>return</span> <span class=mf>1.</span><span class=o>;</span> <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=err>　　</span><span class=c1>//定义了disk折扣价格是0.5 对折。
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=err>　　</span><span class=kd>public</span> <span class=kt>double</span> <span class=nf>discountPrice</span><span class=o>()</span> <span class=o>{</span> <span class=k>return</span> <span class=mf>.5</span><span class=o>;</span> <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span> 
</span></span></code></pre></div><p>Disk是组合体内的一个对象，或称一个部件，这个部件是个单独元素( Primitive)。
还有一种可能是，一个部件也是一个组合体，就是说这个部件下面还有&rsquo;儿子&rsquo;，这是树形结构中通常的情况，应该比较容易理解。现在我们先要定义这个组合体：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>abstract</span> <span class=kd>class</span> <span class=nc>CompositeEquipment</span> <span class=kd>extends</span> <span class=n>Equipment</span>
</span></span><span class=line><span class=cl><span class=o>{</span>
</span></span><span class=line><span class=cl><span class=err>　　</span><span class=kd>private</span> <span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=o>;</span> 
</span></span><span class=line><span class=cl><span class=err>　　</span><span class=c1>//定义一个Vector 用来存放&#39;儿子&#39;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=err>　　</span><span class=kd>private</span> <span class=n>Lsit</span> <span class=n>equipment</span><span class=o>=</span><span class=k>new</span> <span class=n>ArrayList</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>　　</span><span class=kd>public</span> <span class=nf>CompositeEquipment</span><span class=o>(</span><span class=n>String</span> <span class=n>name</span><span class=o>)</span> <span class=o>{</span> <span class=kd>super</span><span class=o>(</span><span class=n>name</span><span class=o>);</span> <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>　　</span><span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>add</span><span class=o>(</span><span class=n>Equipment</span> <span class=n>equipment</span><span class=o>)</span> <span class=o>{</span> 
</span></span><span class=line><span class=cl><span class=err>　　　　</span> <span class=k>this</span><span class=o>.</span><span class=na>equipment</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=n>equipment</span><span class=o>);</span> 
</span></span><span class=line><span class=cl><span class=err>　　　　</span> <span class=k>return</span> <span class=kc>true</span><span class=o>;</span> 
</span></span><span class=line><span class=cl><span class=err>　　</span> <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>　　</span><span class=kd>public</span> <span class=kt>double</span> <span class=nf>netPrice</span><span class=o>()</span> 
</span></span><span class=line><span class=cl><span class=err>　　</span><span class=o>{</span>
</span></span><span class=line><span class=cl><span class=err>　　　　</span><span class=kt>double</span> <span class=n>netPrice</span><span class=o>=</span><span class=mf>0.</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=err>　　　　</span><span class=n>Iterator</span> <span class=n>iter</span><span class=o>=</span><span class=n>equipment</span><span class=o>.</span><span class=na>iterator</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=err>　　　　</span><span class=k>for</span><span class=o>(</span><span class=n>iter</span><span class=o>.</span><span class=na>hasNext</span><span class=o>())</span>
</span></span><span class=line><span class=cl><span class=err>　　　　　　</span><span class=n>netPrice</span><span class=o>+=((</span><span class=n>Equipment</span><span class=o>)</span><span class=n>iter</span><span class=o>.</span><span class=na>next</span><span class=o>()).</span><span class=na>netPrice</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=err>　　　　</span><span class=k>return</span> <span class=n>netPrice</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=err>　　</span><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>　　</span><span class=kd>public</span> <span class=kt>double</span> <span class=nf>discountPrice</span><span class=o>()</span> 
</span></span><span class=line><span class=cl><span class=err>　　</span><span class=o>{</span>
</span></span><span class=line><span class=cl><span class=err>　　　　</span><span class=kt>double</span> <span class=n>discountPrice</span><span class=o>=</span><span class=mf>0.</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=err>　　　　</span><span class=n>Iterator</span> <span class=n>iter</span><span class=o>=</span><span class=n>equipment</span><span class=o>.</span><span class=na>iterator</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=err>　　　　</span><span class=k>for</span><span class=o>(</span><span class=n>iter</span><span class=o>.</span><span class=na>hasNext</span><span class=o>())</span>
</span></span><span class=line><span class=cl><span class=err>　　　　　　</span><span class=n>discountPrice</span><span class=o>+=((</span><span class=n>Equipment</span><span class=o>)</span><span class=n>iter</span><span class=o>.</span><span class=na>next</span><span class=o>()).</span><span class=na>discountPrice</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=err>　　　　</span><span class=k>return</span> <span class=n>discountPrice</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=err>　　</span><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=err>　　</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>　　</span><span class=c1>//注意这里，这里就提供用于访问自己组合体内的部件方法。
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=err>　　</span><span class=c1>//上面dIsk 之所以没有，是因为Disk是个单独(Primitive)的元素.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=err>　　</span><span class=kd>public</span> <span class=n>Iterator</span> <span class=nf>iter</span><span class=o>()</span>
</span></span><span class=line><span class=cl><span class=err>　　</span><span class=o>{</span>
</span></span><span class=line><span class=cl><span class=err>　　　　</span><span class=k>return</span> <span class=n>equipment</span><span class=o>.</span><span class=na>iterator</span><span class=o>()</span> <span class=o>;</span>
</span></span><span class=line><span class=cl><span class=err>　　</span><span class=o>{</span>
</span></span><span class=line><span class=cl><span class=err>　　</span><span class=c1>//重载Iterator方法
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=err>　　</span> <span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>hasNext</span><span class=o>()</span> <span class=o>{</span> <span class=k>return</span> <span class=n>i</span><span class=o>&lt;</span><span class=n>equipment</span><span class=o>.</span><span class=na>size</span><span class=o>();</span> <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=err>　　</span><span class=c1>//重载Iterator方法
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=err>　　</span> <span class=kd>public</span> <span class=n>Object</span> <span class=nf>next</span><span class=o>()</span>
</span></span><span class=line><span class=cl><span class=err>　　</span> <span class=o>{</span>
</span></span><span class=line><span class=cl><span class=err>　　　　</span><span class=k>if</span><span class=o>(</span><span class=n>hasNext</span><span class=o>())</span>
</span></span><span class=line><span class=cl><span class=err>　　　　　　</span> <span class=k>return</span> <span class=n>equipment</span><span class=o>.</span><span class=na>elementAt</span><span class=o>(</span><span class=n>i</span><span class=o>++);</span>
</span></span><span class=line><span class=cl><span class=err>　　　　</span><span class=k>else</span> 
</span></span><span class=line><span class=cl><span class=err>　　</span> <span class=err>　　</span> <span class=err>　</span> <span class=k>throw</span> <span class=k>new</span> <span class=n>NoSuchElementException</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=err>　　</span> <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>上面CompositeEquipment继承了Equipment,同时为自己里面的对象们提供了外部访问的方法,重载了Iterator,Iterator是Java的Collection的一个接口，是Iterator模式的实现.</p><p>我们再看看CompositeEquipment的两个具体类:盘盒Chassis和箱子Cabinet，箱子里面可以放很多东西，如底板，电源盒，硬盘盒等；盘盒里面可以放一些小设备，如硬盘 软驱等。无疑这两个都是属于组合体性质的。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Chassis</span> <span class=kd>extends</span> <span class=n>CompositeEquipment</span>
</span></span><span class=line><span class=cl><span class=o>{</span>
</span></span><span class=line><span class=cl><span class=err>　　</span> <span class=kd>public</span> <span class=nf>Chassis</span><span class=o>(</span><span class=n>String</span> <span class=n>name</span><span class=o>)</span> <span class=o>{</span> <span class=kd>super</span><span class=o>(</span><span class=n>name</span><span class=o>);</span> <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=err>　　</span> <span class=kd>public</span> <span class=kt>double</span> <span class=nf>netPrice</span><span class=o>()</span> <span class=o>{</span> <span class=k>return</span> <span class=mf>1.</span><span class=o>+</span><span class=kd>super</span><span class=o>.</span><span class=na>netPrice</span><span class=o>();</span> <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=err>　　</span> <span class=kd>public</span> <span class=kt>double</span> <span class=nf>discountPrice</span><span class=o>()</span> <span class=o>{</span> <span class=k>return</span> <span class=mf>.5</span><span class=o>+</span><span class=kd>super</span><span class=o>.</span><span class=na>discountPrice</span><span class=o>();</span> <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Cabinet</span> <span class=kd>extends</span> <span class=n>CompositeEquipment</span>
</span></span><span class=line><span class=cl><span class=o>{</span>
</span></span><span class=line><span class=cl><span class=err>　　</span> <span class=kd>public</span> <span class=nf>Cabinet</span><span class=o>(</span><span class=n>String</span> <span class=n>name</span><span class=o>)</span> <span class=o>{</span> <span class=kd>super</span><span class=o>(</span><span class=n>name</span><span class=o>);</span> <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=err>　　</span> <span class=kd>public</span> <span class=kt>double</span> <span class=nf>netPrice</span><span class=o>()</span> <span class=o>{</span> <span class=k>return</span> <span class=mf>1.</span><span class=o>+</span><span class=kd>super</span><span class=o>.</span><span class=na>netPrice</span><span class=o>();</span> <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=err>　　</span> <span class=kd>public</span> <span class=kt>double</span> <span class=nf>discountPrice</span><span class=o>()</span> <span class=o>{</span> <span class=k>return</span> <span class=mf>.5</span><span class=o>+</span><span class=kd>super</span><span class=o>.</span><span class=na>discountPrice</span><span class=o>();</span> <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>至此我们完成了整个Composite模式的架构。</p><p>我们可以看看客户端调用Composote代码:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>Cabinet</span> <span class=n>cabinet</span><span class=o>=</span><span class=k>new</span> <span class=n>Cabinet</span><span class=o>(</span><span class=s>&#34;Tower&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Chassis</span> <span class=n>chassis</span><span class=o>=</span><span class=k>new</span> <span class=n>Chassis</span><span class=o>(</span><span class=s>&#34;PC Chassis&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=c1>//将PC Chassis装到Tower中 (将盘盒装到箱子里)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>cabinet</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=n>chassis</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=c1>//将一个10GB的硬盘装到 PC Chassis (将硬盘装到盘盒里)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>chassis</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=k>new</span> <span class=n>Disk</span><span class=o>(</span><span class=s>&#34;10 GB&#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>//调用 netPrice()方法;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;netPrice=&#34;</span><span class=o>+</span><span class=n>cabinet</span><span class=o>.</span><span class=na>netPrice</span><span class=o>());</span>
</span></span><span class=line><span class=cl><span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;discountPrice=&#34;</span><span class=o>+</span><span class=n>cabinet</span><span class=o>.</span><span class=na>discountPrice</span><span class=o>());</span>
</span></span></code></pre></div><p>上面调用的方法netPrice()或discountPrice()，实际上Composite使用Iterator遍历了整个树形结构,寻找同样包含这个方法的对象并实现调用执行.</p><p>Composite是个很巧妙体现智慧的模式，在实际应用中，如果碰到树形结构，我们就可以尝试是否可以使用这个模式。</p></div><footer class=post-footer><ul class=post-tags><li><a href=http://blog.chalme.top/tags/design-patterns/>Design Patterns</a></li></ul><nav class=paginav><a class=prev href=http://blog.chalme.top/posts/design-patterns/2.6-bridge/><span class=title>« Prev</span><br><span>2.6 Bridge</span></a>
<a class=next href=http://blog.chalme.top/posts/design-patterns/2.5-decorator/><span class=title>Next »</span><br><span>2.5 Decorator</span></a></nav></footer><div id=disqus_thread></div><script>(function(){var e=document,t=e.createElement("script");t.src="https://pc-chalme.disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></article></main><footer class=footer><span>&copy; 2023 <a href=http://blog.chalme.top/>Chalme</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>